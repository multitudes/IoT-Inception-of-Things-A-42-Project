# 🌐 Part 2 (P2) - K3s with Ingress and Multiple Applications

This part demonstrates a K3s cluster with an Ingress controller managing traffic to multiple applications, showcasing load balancing and routing capabilities.

## 📋 Prerequisites

- Vagrant and VirtualBox installed
- At least 4GB of available RAM
- Host file modification capabilities (for domain resolution)

## 🔧 Setup Instructions

### 1. Navigate to the P2 directory

```bash
cd p2
```

### 2. Start the infrastructure and deploy applications

```bash
./start-up-p2.sh
```

> **What this does**:
> - Provisions a K3s server with Ingress controller
> - Deploys 3 different applications (app1, app2, app3)
> - Configures Ingress rules for domain-based routing
> - Sets up load balancing between application replicas

### 3. Test the applications

Test each application through their respective domains:

```bash
curl http://app1.com
curl http://app2.com
curl http://app3.com
```

> **Why these work**: The Ingress controller routes requests based on the `Host` header to the appropriate backend services.

### 4. Verify the cluster status

Connect to the server and inspect the cluster:

```bash
cd infra
vagrant ssh
sudo kubectl get nodes -o wide
exit
```

### 5. Clean up resources

When finished testing:

```bash
cd ..
./clean-up-p2
```

## 🎯 What this accomplishes

- **Ingress Controller**: Routes external traffic to internal services based on hostnames
- **Multiple Applications**: Demonstrates service discovery and load balancing
- **Domain-based Routing**: Shows how different domains can point to different services
- **Service Mesh**: Basic implementation of microservices architecture
- **Load Balancing**: Traffic distribution across multiple application replicas

## 🏗️ Architecture Overview

```
Internet → Ingress Controller → Services → Pods
    ↓              ↓              ↓        ↓
app1.com    →  app1-service  →  app1-pods
app2.com    →  app2-service  →  app2-pods  
app3.com    →  app3-service  →  app3-pods
```

## ✅ Expected Output

- **curl commands**: Should return different responses from each application
- **kubectl get nodes**: Shows the single K3s server node in Ready state
- **Applications**: Each app accessible via its dedicated domain
- **Load balancing**: Multiple requests may hit different pod replicas

## 🔧 Troubleshooting

If the curl commands don't work:
1. Check if the domains resolve: `nslookup app1.com`
2. Verify Ingress is running: `kubectl get ingress`
3. Check service endpoints: `kubectl get services`
4. Ensure all pods are ready: `kubectl get pods`

## 📚 Key Concepts Demonstrated

- **Ingress**: Layer 7 load balancing and SSL termination
- **Services**: Stable network endpoints for pods
- **Deployments**: Declarative pod management and scaling
- **ConfigMaps/Secrets**: Configuration management
- **Namespaces**: Resource isolation and organization
